#!/bin/bash
# Full deployment script with error handling

# Get model artifacts path
MODEL_DIR=$(gcloud ai custom-jobs describe $JOB_ID \
  --format="value(jobSpec.workerPoolSpecs[0].containerSpec.args)" | \
  grep -o "gs://[^ ]*/model")

# Register model
MODEL_ID=$(gcloud ai models upload \
  --region=us-central1 \
  --display-name=iris-model \
  --container-image-uri=gcr.io/healthvision-ml-dev/ml-pipeline:prod-final \
  --artifact-uri=$MODEL_DIR \
  --format="value(name)")

# Create endpoint
ENDPOINT_ID=$(gcloud ai endpoints create \
  --region=us-central1 \
  --display-name=iris-endpoint \
  --format="value(name)")

# Deploy model
gcloud ai endpoints deploy-model $ENDPOINT_ID \
  --region=us-central1 \
  --model=$MODEL_ID \
  --machine-type=n1-standard-4